#!/bin/bash

if [ "$1" = "clean" ]; then
make clean || exit -1
cd Xvnc
make clean || exit -1
cd ..
fi

xmkmf || exit -1
make World || exit -1
cd Xvnc
./configure || exit -1
make || exit -1
cd ..

rm -rf rpms/
mkdir -p rpms/RPMS
cd rpms; ln -fs .. BUILD; cd ..

rpmbuild -bb --buildroot `pwd`/rpms/TurboVNC-buildroot --define "_topdir `pwd`/rpms" \
	--define "_bindir /opt/TurboVNC/bin" --define "_mandir /opt/TurboVNC/man" \
	--define "_datadir /opt/TurboVNC" --define "_build `date +%Y%m%d`" turbovnc.spec
mv rpms/RPMS/i386/turbovnc*.rpm .
rm -rf rpms/
