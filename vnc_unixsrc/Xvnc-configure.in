#!/bin/sh
# configure
#
# This script sets up for a build.  It has been tested on the following
# Operating System versions (uname outputs):
#
#    Solaris 10 (SunOS 5.10)
#    Linux 2.4 and 2.6

CPU=@host_cpu@
CC="@CC@"
GCC=@GCC@
CFLAGS="@CFLAGS@"
LDFLAGS="@LDFLAGS@"
MEDIALIB=@USE_MEDIALIB@
if [ "$MEDIALIB" = "yes" ]; then
  JPEGINC=-I@abs_top_srcdir@/turbojpeg
  JPEGLINK="-lmlib `pwd`/../turbojpeg/libturbojpeg.a"
else
  JPEGINC="@JPEG_CFLAGS@"
  JPEGLINK="@JPEG_LDFLAGS@"
fi

SYSNAME=`uname -s`
REV=`uname -r`
MAJOR=`echo $REV | awk -F. 'NF < 1 {print "0"} {print $1}'`
MINOR=`echo $REV | awk -F. 'NF < 2 {print "0"} {print $2}'`
TEENY=`echo $REV | awk -F. 'NF < 3 {print "0"} {print $3}'`

echo "#define OSName $SYSNAME" > config/cf/platform.def
echo "#define OSMajorVersion $MAJOR" >> config/cf/platform.def
echo "#define OSMinorVersion $MINOR" >> config/cf/platform.def
echo "#define OSTeenyVersion $TEENY" >> config/cf/platform.def
echo "#define LinuxCLibMajorVersion 6" >> config/cf/platform.def
if [ "$GCC" = "yes" ]; then
    echo "#define HasGcc2 YES" >> config/cf/platform.def
fi
case "$CPU" in
    i*86)
        echo "#define i386Architecture" >> config/cf/platform.def
        echo "#undef AMD64Architecture" >> config/cf/platform.def
        ;;
    x86_64 | amd64)
        echo "#define AMD64Architecture" >> config/cf/platform.def
        ;;
esac
if [ ! "$JPEGINC" = "" ]; then
    echo "#define JPEGIncludeFlags $JPEGINC" >>config/cf/platform.def
fi
if [ ! "$JPEGLINK" = "" ]; then
    echo "#define JPEGLibraryFlags $JPEGLINK" >>config/cf/platform.def
fi
echo '#define VncIncludeDir "-I@abs_top_srcdir@/include"' >>config/cf/platform.def

exit 0
